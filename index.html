<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Boxster Escape: Rio Edition üáßüá∑</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    touch-action: none;
  }
  canvas { display: block; }
  #startScreen, #gameOverScreen {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.85);
    z-index: 10;
    color: white;
    text-align: center;
    padding: 20px;
  }
  #startScreen h1 {
    font-size: 28px;
    margin-bottom: 10px;
    text-shadow: 0 0 20px #FFD700;
    color: #FFD700;
  }
  #startScreen h2 {
    font-size: 16px;
    color: #aaa;
    margin-bottom: 30px;
    font-weight: normal;
  }
  .btn {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #000;
    border: none;
    padding: 15px 50px;
    font-size: 22px;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    margin-top: 20px;
    box-shadow: 0 0 30px rgba(255,215,0,0.4);
    transition: transform 0.2s;
  }
  .btn:hover { transform: scale(1.05); }
  #gameOverScreen h1 { font-size: 32px; color: #ff4444; margin-bottom: 10px; }
  #gameOverScreen .score { font-size: 24px; color: #FFD700; margin: 15px 0; }
  #obstacleList {
    text-align: left;
    margin: 15px 0;
    font-size: 13px;
    color: #ccc;
    line-height: 1.8;
  }
  #obstacleList span { font-size: 18px; }
</style>
</head>
<body>

<div id="startScreen">
  <h1>üèéÔ∏è BOXSTER ESCAPE üèéÔ∏è</h1>
  <h2>Rio de Janeiro Edition</h2>
  <div id="obstacleList">
    <span>üßî</span> Dodge Lula<br>
    <span>üí∞</span> Dodge Taxes (IPVA, IR, ICMS...)<br>
    <span>üëî</span> Dodge Haddad<br>
    <span>üèõÔ∏è</span> Dodge Bad Governance<br>
    <span>üò¥</span> Dodge Sleep Deprivation<br>
    <span>üéæ</span> Dodge Your Bad Forehand<br>
  </div>
  <button class="btn" id="startBtn">ACELERA! üöóüí®</button>
  <p style="color:#666; margin-top:15px; font-size:12px;">Swipe or tap left/right to steer</p>
</div>

<div id="gameOverScreen" style="display:none;">
  <h1>PEGARAM VOC√ä! üòµ</h1>
  <div class="score">Score: <span id="finalScore">0</span></div>
  <div id="killedBy" style="font-size:18px; margin:10px 0;"></div>
  <button class="btn" id="restartBtn">TENTAR DE NOVO üîÑ</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// Responsive canvas
function resize() {
  canvas.width = Math.min(window.innerWidth, 420);
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// Game state
let gameRunning = false;
let score = 0;
let speed = 3;
let obstacles = [];
let roadLines = [];
let buildings = [];
let frameCount = 0;
let car = { x: 0, y: 0, w: 50, h: 90 };
let targetX = 0;
let touchStartX = 0;
let palmTrees = [];

// Driver face (we'll draw a cartoon version)
const driverFace = {
  draw(x, y, size) {
    // Head
    ctx.fillStyle = '#F4C28B';
    ctx.beginPath();
    ctx.ellipse(x, y, size * 0.5, size * 0.6, 0, 0, Math.PI * 2);
    ctx.fill();
    // Hair
    ctx.fillStyle = '#3A2010';
    ctx.beginPath();
    ctx.ellipse(x, y - size * 0.35, size * 0.5, size * 0.35, 0, Math.PI, Math.PI * 2);
    ctx.fill();
    // Sunglasses
    ctx.fillStyle = '#111';
    ctx.fillRect(x - size * 0.4, y - size * 0.15, size * 0.35, size * 0.2);
    ctx.fillRect(x + size * 0.05, y - size * 0.15, size * 0.35, size * 0.2);
    ctx.fillRect(x - size * 0.4, y - size * 0.1, size * 0.8, size * 0.04);
    // Smile
    ctx.strokeStyle = '#A0522D';
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.arc(x, y + size * 0.1, size * 0.2, 0.1, Math.PI - 0.1);
    ctx.stroke();
    // Beard stubble
    ctx.fillStyle = 'rgba(60,30,10,0.2)';
    ctx.beginPath();
    ctx.ellipse(x, y + size * 0.25, size * 0.35, size * 0.25, 0, 0, Math.PI);
    ctx.fill();
  }
};

// Obstacle types
const obstacleTypes = [
  {
    name: 'Lula',
    emoji: 'üßî',
    color: '#cc0000',
    label: 'LULA',
    deathMsg: 'Lula te pegou! "Companheiro, vem pro meu lado!" üßî'
  },
  {
    name: 'Taxes',
    emoji: 'üí∞',
    color: '#228B22',
    label: 'IMPOSTO',
    variants: ['IPVA', 'IR', 'ICMS', 'ISS', 'IPTU', 'IOF', 'PIS', 'COFINS'],
    deathMsg: 'Os impostos te pegaram! N√£o tem como fugir do Le√£o! ü¶Åüí∞'
  },
  {
    name: 'Haddad',
    emoji: 'üëî',
    color: '#cc3333',
    label: 'HADDAD',
    deathMsg: 'Haddad te parou! Nova taxa: respirar na Paulista! üëî'
  },
  {
    name: 'Bad Governance',
    emoji: 'üèõÔ∏è',
    color: '#555555',
    label: 'GEST√ÉO',
    deathMsg: 'A m√° gest√£o do pa√≠s te alcan√ßou! PIB caiu üìâ'
  },
  {
    name: 'Sleep Deprivation',
    emoji: 'üò¥',
    color: '#6A0DAD',
    label: 'SONO',
    deathMsg: 'Dormiu no volante! Deveria ter dormido mais cedo! üò¥üí§'
  },
  {
    name: 'Bad Forehand',
    emoji: 'üéæ',
    color: '#CCCC00',
    label: 'FOREHAND',
    deathMsg: 'Seu forehand ruim te derrubou! Bola na rede! üéæüò©'
  }
];

function initGame() {
  score = 0;
  speed = 3;
  obstacles = [];
  roadLines = [];
  buildings = [];
  palmTrees = [];
  frameCount = 0;
  car.w = 50;
  car.h = 90;
  car.x = canvas.width / 2 - car.w / 2;
  car.y = canvas.height - car.h - 40;
  targetX = car.x;

  // Init road lines
  for (let i = 0; i < 10; i++) {
    roadLines.push({ y: i * 80 });
  }

  // Init buildings
  for (let side = 0; side < 2; side++) {
    for (let i = 0; i < 8; i++) {
      buildings.push({
        x: side === 0 ? -5 : canvas.width - 45,
        y: i * 120 - 60,
        w: 50,
        h: 80 + Math.random() * 60,
        color: `hsl(${Math.random()*60+15}, 40%, ${30+Math.random()*20}%)`,
        side: side
      });
    }
  }

  // Palm trees
  for (let i = 0; i < 6; i++) {
    palmTrees.push({
      x: Math.random() > 0.5 ? 55 + Math.random() * 15 : canvas.width - 70 - Math.random() * 15,
      y: i * 150 + Math.random() * 50
    });
  }
}

function spawnObstacle() {
  const roadLeft = 60;
  const roadRight = canvas.width - 60;
  const type = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
  const size = 40 + Math.random() * 15;

  let label = type.label;
  if (type.variants) {
    label = type.variants[Math.floor(Math.random() * type.variants.length)];
  }

  obstacles.push({
    x: roadLeft + Math.random() * (roadRight - roadLeft - size),
    y: -size,
    w: size,
    h: size,
    speed: speed * (0.8 + Math.random() * 0.5),
    type: type,
    label: label,
    rotation: 0,
    rotSpeed: (Math.random() - 0.5) * 0.05
  });
}

function drawRoad() {
  // Sky gradient
  const skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.3);
  skyGrad.addColorStop(0, '#1a1a2e');
  skyGrad.addColorStop(1, '#16213e');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Road
  const roadLeft = 55;
  const roadRight = canvas.width - 55;
  ctx.fillStyle = '#333';
  ctx.fillRect(roadLeft, 0, roadRight - roadLeft, canvas.height);

  // Sidewalks
  ctx.fillStyle = '#666';
  ctx.fillRect(roadLeft - 10, 0, 12, canvas.height);
  ctx.fillRect(roadRight - 2, 0, 12, canvas.height);

  // Road lines
  ctx.setLineDash([30, 30]);
  ctx.strokeStyle = '#FFD700';
  ctx.lineWidth = 2;
  for (let line of roadLines) {
    line.y += speed;
    if (line.y > canvas.height) line.y -= 800;
  }
  const centerX = canvas.width / 2;
  ctx.beginPath();
  ctx.moveTo(centerX, 0);
  ctx.lineTo(centerX, canvas.height);
  ctx.stroke();
  ctx.setLineDash([]);

  // Road edge lines
  ctx.strokeStyle = '#fff';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(roadLeft + 2, 0);
  ctx.lineTo(roadLeft + 2, canvas.height);
  ctx.moveTo(roadRight - 2, 0);
  ctx.lineTo(roadRight - 2, canvas.height);
  ctx.stroke();
}

function drawBuildings() {
  for (let b of buildings) {
    b.y += speed * 0.5;
    if (b.y > canvas.height + 50) {
      b.y -= 960;
      b.h = 80 + Math.random() * 60;
      b.color = `hsl(${Math.random()*60+15}, 40%, ${30+Math.random()*20}%)`;
    }
    ctx.fillStyle = b.color;
    ctx.fillRect(b.x, b.y, b.w, b.h);
    // Windows
    ctx.fillStyle = 'rgba(255,255,150,0.6)';
    for (let wy = b.y + 8; wy < b.y + b.h - 8; wy += 18) {
      for (let wx = b.x + 8; wx < b.x + b.w - 8; wx += 16) {
        if (Math.random() > 0.3) {
          ctx.fillRect(wx, wy, 8, 10);
        }
      }
    }
  }
}

function drawPalmTree(x, y) {
  // Trunk
  ctx.fillStyle = '#8B6914';
  ctx.fillRect(x - 3, y, 6, 35);
  // Leaves
  ctx.fillStyle = '#228B22';
  for (let i = 0; i < 5; i++) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(i * Math.PI * 2 / 5 + frameCount * 0.005);
    ctx.beginPath();
    ctx.ellipse(12, 0, 18, 5, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

function drawPalmTrees() {
  for (let p of palmTrees) {
    p.y += speed * 0.7;
    if (p.y > canvas.height + 50) {
      p.y -= 900;
      p.x = Math.random() > 0.5 ? 55 + Math.random() * 15 : canvas.width - 70 - Math.random() * 15;
    }
    drawPalmTree(p.x, p.y);
  }
}

function drawCar() {
  const x = car.x;
  const y = car.y;
  const w = car.w;
  const h = car.h;

  // Shadow
  ctx.fillStyle = 'rgba(0,0,0,0.3)';
  ctx.beginPath();
  ctx.ellipse(x + w/2 + 3, y + h - 5, w/2 + 5, 12, 0, 0, Math.PI * 2);
  ctx.fill();

  // Car body - Black Boxster 718
  ctx.fillStyle = '#1a1a1a';
  ctx.beginPath();
  ctx.roundRect(x + 3, y + 15, w - 6, h - 20, 8);
  ctx.fill();

  // Car front curve
  ctx.beginPath();
  ctx.roundRect(x + 6, y + h - 25, w - 12, 20, [0, 0, 6, 6]);
  ctx.fill();

  // Car rear
  ctx.fillStyle = '#111';
  ctx.beginPath();
  ctx.roundRect(x + 5, y + 5, w - 10, 25, [8, 8, 0, 0]);
  ctx.fill();

  // Windshield
  ctx.fillStyle = '#2a4a7a';
  ctx.beginPath();
  ctx.roundRect(x + 8, y + 25, w - 16, 22, 4);
  ctx.fill();

  // Driver face in car
  driverFace.draw(x + w/2, y + 35, 18);

  // Headlights
  ctx.fillStyle = '#FFD700';
  ctx.shadowColor = '#FFD700';
  ctx.shadowBlur = 10;
  ctx.beginPath();
  ctx.ellipse(x + 10, y + h - 12, 4, 3, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.beginPath();
  ctx.ellipse(x + w - 10, y + h - 12, 4, 3, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // Tail lights
  ctx.fillStyle = '#ff0000';
  ctx.shadowColor = '#ff0000';
  ctx.shadowBlur = 8;
  ctx.fillRect(x + 7, y + 8, 8, 4);
  ctx.fillRect(x + w - 15, y + 8, 8, 4);
  ctx.shadowBlur = 0;

  // Porsche stripe detail
  ctx.strokeStyle = '#333';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(x + w/2, y + 50);
  ctx.lineTo(x + w/2, y + h - 10);
  ctx.stroke();

  // Side mirrors
  ctx.fillStyle = '#1a1a1a';
  ctx.fillRect(x - 3, y + 28, 5, 6);
  ctx.fillRect(x + w - 2, y + 28, 5, 6);

  // Wheels
  ctx.fillStyle = '#222';
  ctx.fillRect(x - 1, y + 18, 5, 14);
  ctx.fillRect(x + w - 4, y + 18, 5, 14);
  ctx.fillRect(x - 1, y + h - 25, 5, 14);
  ctx.fillRect(x + w - 4, y + h - 25, 5, 14);
  // Wheel rims
  ctx.fillStyle = '#888';
  ctx.fillRect(x, y + 21, 3, 8);
  ctx.fillRect(x + w - 3, y + 21, 3, 8);
  ctx.fillRect(x, y + h - 22, 3, 8);
  ctx.fillRect(x + w - 3, y + h - 22, 3, 8);
}

function drawObstacle(obs) {
  ctx.save();
  ctx.translate(obs.x + obs.w/2, obs.y + obs.h/2);
  obs.rotation += obs.rotSpeed;
  ctx.rotate(obs.rotation);

  // Background circle
  ctx.fillStyle = obs.type.color;
  ctx.globalAlpha = 0.85;
  ctx.beginPath();
  ctx.arc(0, 0, obs.w/2 + 4, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;

  // Emoji
  ctx.font = `${obs.w * 0.65}px serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(obs.type.emoji, 0, -2);

  // Label
  ctx.font = `bold ${Math.max(8, obs.w * 0.22)}px Arial`;
  ctx.fillStyle = '#fff';
  ctx.fillText(obs.label, 0, obs.w/2 + 2);

  ctx.restore();
}

function drawHUD() {
  // Score
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.fillRect(10, 10, 120, 35);
  ctx.fillStyle = '#FFD700';
  ctx.font = 'bold 20px Arial';
  ctx.textAlign = 'left';
  ctx.fillText(`üèÜ ${score}`, 20, 34);

  // Speed indicator
  ctx.fillStyle = 'rgba(0,0,0,0.5)';
  ctx.fillRect(canvas.width - 100, 10, 90, 35);
  ctx.fillStyle = '#00ff88';
  ctx.font = 'bold 16px Arial';
  ctx.textAlign = 'right';
  ctx.fillText(`${Math.floor(speed * 30)} km/h`, canvas.width - 18, 33);

  // Rio skyline silhouette at top
  ctx.fillStyle = 'rgba(50,50,80,0.4)';
  // Cristo Redentor silhouette
  const cx = canvas.width * 0.7;
  ctx.beginPath();
  ctx.moveTo(cx - 15, 50);
  ctx.lineTo(cx - 3, 15);
  ctx.lineTo(cx - 12, 15);
  ctx.lineTo(cx - 12, 8);
  ctx.lineTo(cx + 12, 8);
  ctx.lineTo(cx + 12, 15);
  ctx.lineTo(cx + 3, 15);
  ctx.lineTo(cx + 15, 50);
  ctx.fill();

  // Sugarloaf mountain
  ctx.beginPath();
  ctx.moveTo(canvas.width * 0.2 - 30, 55);
  ctx.quadraticCurveTo(canvas.width * 0.2, 10, canvas.width * 0.2 + 30, 55);
  ctx.fill();
}

function checkCollision(obs) {
  const padding = 8;
  return car.x + padding < obs.x + obs.w &&
         car.x + car.w - padding > obs.x &&
         car.y + padding < obs.y + obs.h &&
         car.y + car.h - padding > obs.y;
}

function gameOver(obs) {
  gameRunning = false;
  document.getElementById('finalScore').textContent = score;
  document.getElementById('killedBy').innerHTML = obs.type.deathMsg;
  document.getElementById('gameOverScreen').style.display = 'flex';
}

function update() {
  if (!gameRunning) return;

  frameCount++;
  score++;

  // Increase difficulty
  if (frameCount % 500 === 0) {
    speed += 0.3;
  }

  // Spawn obstacles
  const spawnRate = Math.max(30, 80 - Math.floor(score / 200) * 5);
  if (frameCount % spawnRate === 0) {
    spawnObstacle();
  }

  // Move car toward target
  const dx = targetX - car.x;
  car.x += dx * 0.12;

  // Clamp car to road
  const roadLeft = 60;
  const roadRight = canvas.width - 60 - car.w;
  car.x = Math.max(roadLeft, Math.min(roadRight, car.x));

  // Update obstacles
  for (let i = obstacles.length - 1; i >= 0; i--) {
    obstacles[i].y += obstacles[i].speed;
    if (obstacles[i].y > canvas.height + 50) {
      obstacles.splice(i, 1);
      continue;
    }
    if (checkCollision(obstacles[i])) {
      gameOver(obstacles[i]);
      return;
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawRoad();
  drawBuildings();
  drawPalmTrees();

  for (let obs of obstacles) {
    drawObstacle(obs);
  }

  drawCar();
  drawHUD();
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

// Controls
// Touch
let isTouching = false;
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  isTouching = true;
  touchStartX = e.touches[0].clientX;
  const rect = canvas.getBoundingClientRect();
  const touchX = e.touches[0].clientX - rect.left;
  targetX = touchX - car.w / 2;
});

canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  if (!isTouching) return;
  const rect = canvas.getBoundingClientRect();
  const touchX = e.touches[0].clientX - rect.left;
  targetX = touchX - car.w / 2;
});

canvas.addEventListener('touchend', () => {
  isTouching = false;
});

// Mouse
canvas.addEventListener('mousemove', (e) => {
  if (!gameRunning) return;
  const rect = canvas.getBoundingClientRect();
  targetX = e.clientX - rect.left - car.w / 2;
});

// Keyboard
document.addEventListener('keydown', (e) => {
  if (!gameRunning) return;
  if (e.key === 'ArrowLeft' || e.key === 'a') targetX = car.x - 30;
  if (e.key === 'ArrowRight' || e.key === 'd') targetX = car.x + 30;
});

// Start / Restart
document.getElementById('startBtn').addEventListener('click', () => {
  document.getElementById('startScreen').style.display = 'none';
  initGame();
  gameRunning = true;
});

document.getElementById('restartBtn').addEventListener('click', () => {
  document.getElementById('gameOverScreen').style.display = 'none';
  initGame();
  gameRunning = true;
});

// Init and start loop
initGame();
loop();
</script>

</body>
</html>
